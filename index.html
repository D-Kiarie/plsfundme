<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Roblox Gamepass Finder</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: radial-gradient(circle at top, #0f172a, #1e293b);
    }
    .glass {
      background: rgba(30, 41, 59, 0.65);
      backdrop-filter: blur(14px);
      border: 1px solid rgba(255, 255, 255, 0.08);
    }
  </style>
</head>
<body class="text-white flex items-center justify-center min-h-screen p-4">
  <div class="w-full max-w-5xl mx-auto p-6 md:p-10 glass rounded-2xl shadow-2xl">
    <h1 class="text-4xl font-extrabold text-center mb-2 text-cyan-400 tracking-tight drop-shadow-md">Roblox Gamepass Finder</h1>
    <p class="text-center text-gray-300 mb-8">Easily search and view all gamepasses owned by any Roblox user.</p>

    <!-- Search Bar -->
    <div class="flex flex-col sm:flex-row gap-3 mb-6">
      <input type="text" id="identifierInput" placeholder="Enter Roblox username or ID..."
        class="flex-grow glass border border-gray-600 text-white rounded-lg px-4 py-3 focus:ring-2 focus:ring-cyan-500 focus:outline-none transition">
      <button id="fetchButton"
        class="bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
        üîç Search
      </button>
    </div>

    <!-- Loader -->
    <div id="loader" class="hidden text-center my-8">
      <div class="inline-block animate-spin rounded-full h-10 w-10 border-b-2 border-cyan-400"></div>
      <p class="mt-2 text-gray-400">Fetching data...</p>
    </div>

    <!-- Results -->
    <div id="results" class="space-y-6"></div>
  </div>

  <script>
    const identifierInput = document.getElementById('identifierInput');
    const fetchButton = document.getElementById('fetchButton');
    const resultsDiv = document.getElementById('results');
    const loader = document.getElementById('loader');

    identifierInput.addEventListener('keyup', (event) => {
      if (event.key === 'Enter') fetchButton.click();
    });

    fetchButton.addEventListener('click', async () => {
      const identifier = identifierInput.value.trim();
      if (!identifier) return displayError('Please enter a username or user ID.');

      resultsDiv.innerHTML = '';
      loader.classList.remove('hidden');

      try {
        const response = await fetch(`https://plsfundme.onrender.com/gamepasses/${identifier}`);
        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error || `Error: ${response.status}`);
        }
        const data = await response.json();
        displayResults(data);
      } catch (error) {
        displayError(error.message);
      } finally {
        loader.classList.add('hidden');
      }
    });

    function displayError(message) {
      resultsDiv.innerHTML = `<div class="glass border border-red-700 text-red-300 px-4 py-3 rounded-lg text-center">${message}</div>`;
    }

    function formatNumber(num) {
      return num.toLocaleString();
    }

    function displayResults(data) {
      if (data.games.length === 0) {
        resultsDiv.innerHTML = `<div class="glass p-4 rounded-lg text-center">No profile-owned games found for this user.</div>`;
        return;
      }

      let html = `
        <div class="glass p-5 rounded-xl shadow-lg space-y-2">
          <div class="flex items-center gap-4">
            <a href="https://www.roblox.com/users/${data.userId}/profile" target="_blank">
              <img src="https://www.roblox.com/headshot-thumbnail/image?userId=${data.userId}&width=150&height=150&format=png" onerror="this.src='https://tr.rbxcdn.com/180x180/Avatar.png'" class="w-16 h-16 rounded-full border-2 border-cyan-400">
            </a>
            <div>
              <h2 class="text-2xl font-bold text-cyan-400">${data.username}</h2>
              <p class="text-gray-300">User ID: ${formatNumber(data.userId)}</p>
              <p class="text-gray-400">Found <span class="text-cyan-300 font-semibold">${formatNumber(data.totalPasses)}</span> passes across <span class="text-cyan-300 font-semibold">${formatNumber(data.totalGames)}</span> games.</p>
            </div>
          </div>
        </div>
      `;

      data.games.forEach(game => {
        if (game.passes.length > 0) {
          html += `
            <div class="glass p-5 rounded-xl shadow-lg">
              <div class="flex items-center justify-between mb-3">
                <h3 class="text-lg font-semibold">${game.gameName}</h3>
                <a href="https://www.roblox.com/games/${game.universeId}" target="_blank" class="text-sm text-cyan-400 hover:underline">View Game</a>
              </div>
              <p class="text-sm text-gray-400 mb-4">Universe ID: ${formatNumber(game.universeId)}</p>
              <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
          `;
          game.passes.forEach(pass => {
            html += `
              <div class="glass p-4 rounded-lg hover:scale-105 transition-transform duration-200">
                <p class="font-semibold text-white truncate">${pass.name}</p>
                <span class="mt-1 inline-block text-xs font-bold px-2 py-1 rounded-full ${pass.price ? 'bg-green-500/20 text-green-300' : 'bg-red-500/20 text-red-300'}">
                  ${pass.price ? `${formatNumber(pass.price)} Robux` : 'Off-sale'}
                </span>
              </div>
            `;
          });
          html += `</div></div>`;
        }
      });

      resultsDiv.innerHTML = html;
    }
  </script>
</body>
</html>
